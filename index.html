<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>ONDC API Contract</title>
  <style>
    body {
      display: flex;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      height: 100vh;
      flex-direction: column;
    }

    header {
      background-color: #333;
      color: #fff;
      padding: 20px;
      text-align: center;
      height: 10%;
    }

    main {
      height: 80%;
      display: flex;
    }

    .select-file {
      height: 10%;
    }

    .left-section {
      width: 67%;
      overflow: scroll;
      padding: 20px;
    }

    .right-section {
      width: 33%;
      display: flex;
      flex-direction: column;
    }

    .section {
      flex: 1;
      padding: 20px;
    }

    .dropdown {
      display: flex;
      flex-direction: column;
      margin-bottom: 10px;
    }

    .dropdown label {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .display-section {
      margin-top: 20px;
    }

    .container {
      display: flex;
      flex-direction: row;
      height: inherit;
    }

    .flows-panel {
      width: 15%;
      display: flex;
      flex-direction: column;
      background-color: #a1a1a1;
      overflow: scroll;
    }

    .flows-panel ul {
      list-style-type: disc;
      padding: 0;
      margin: 0;
    }

    .flows-panel li {
      margin-bottom: 5px;
      height: 20px;
      cursor: pointer;
    }


    .flows-panel li.active {
      font-weight: bold;
    }

    .steps-panel {
      width: 15%;
      display: flex;
      flex-direction: column;
      background-color: #f1f1f1;
    }

    .steps-panel ul {
      list-style-type: upper-roman;
      padding: 0;
      margin: 0;
    }

    .steps-panel li {
      margin-bottom: 5px;
      height: 60px;
      cursor: pointer;
    }


    .steps-panel li.active {
      font-weight: bold;
    }

    .content-panel {
      width: 70%;
      display: flex;
      flex-direction: column;
      padding: 10px;
      background-color: #ffffff;
    }

    .flow-content-section {
      flex: 1;
      overflow: auto;
    }

    .tab {
      display: none;
    }
  </style>
  <!-- Swagger UI CSS -->
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@3.52.0/swagger-ui.css">

</head>

<body>
  <header>
    <h1>ONDC API Contract</h1>
  </header>
  <div class="select-file">
    <table>
      <tr>
        <td><b>Load By Url</b></td>
        <td>
          <input type="text" id="swagger_url" placeholder="Swagger_yaml_url">
          <button onclick="loadSwaggerYaml()">Submit</button>
        </td>
      </tr>
      <tr>
        <td><b>Load By Local File</b></td>
        <td>
          <input type="file" id="file-input" />
        </td>
      </tr>
    </table>
    <div class="tabs">
      <button class="tab-button" onclick="openTab(event, 'swagger-tab')">Swagger</button>
      <button class="tab-button" onclick="openTab(event, 'flow-tab')">Flow</button>
    </div>
  </div>
  <main>
    <section class="left-section">
      <!-- Swagger UI -->
      <div id="swagger-tab" class="tab">
        <div id="swagger-ui"></div>
      </div>
      <div id="flow-tab" class="tab">
        <div id="flow">
          <div class="container">
            <div class="flows-panel">
              <h2>Flows:</h2>
              <ul id="flows-list"></ul>
            </div>
            <div class="steps-panel">
              <h2 id="flow-summary"></h2>
              <p id="flow-description"></p>
              <h3>Steps:</h2>
                <ul id="steps-list"></ul>
            </div>
            <div class="content-panel">
              <h2 id="step-summary"></h2>
              <p id="step-description"></p>
              <h2>Example:</h2>
              <pre id="yaml-content" class="flow-content-section"></pre>
            </div>
          </div>
        </div>
      </div>
    </section>
    <div class="right-section">
      <section class="section">
        <table id="option-table">
          <tr>
            <td><b>API</b></td>
            <td>
              <select id="dropdown1" onchange="loadDropdown2()"></select>
            </td>
          </tr>
          <tr>
            <td><b>Field</b></td>
            <td>
              <select id="dropdown2" onchange="loadDropdown4()"></select>
            </td>
          </tr>
          <tr>
            <td><b>Enum</b></td>
            <td>
              <select id="dropdown4" onchange="displayTable()"></select>
            </td>
          </tr>
        </table>
        <table id="result-table"></table>
        </table>
      </section>
      <section class="section">
        <table id="option-table">
          <tr>
            <td><b>API</b></td>
            <td>
              <select id="tag-schema-dropdown" onchange="loadTagPath()"></select>
            </td>
          </tr>
          <tr>
            <td><b>Field</b></td>
            <td>
              <select id="tag-path-dropdown" onchange="loadTagGroup()"></select>
            </td>
          </tr>
          <tr>
            <td><b>TagGroup</b></td>
            <td>
              <select id="tag-group-dropdown" onchange="loadTag()"></select>
            </td>
          </tr>
          <tr>
            <td><b>Tag</b></td>
            <td>
              <select id="tag-dropdown" onchange="displayTag()"></select>
            </td>
          </tr>
        </table>
        <table id="tag-group-table"></table>
        </table>
        <table id="tag-table"></table>
        </table>
      </section>
    </div>
  </main>
  <!-- Swagger UI initialization -->
  <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@3.52.0/swagger-ui-bundle.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@3.52.0/swagger-ui-standalone-preset.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>

  <script>

    // tabs.js

    function openTab(evt, tabName) {
      // Hide all tab content
      var tabs = document.getElementsByClassName("tab");
      for (var i = 0; i < tabs.length; i++) {
        tabs[i].style.display = "none";
      }

      // Remove active class from all tab buttons
      var tabButtons = document.getElementsByClassName("tab-button");
      for (var i = 0; i < tabButtons.length; i++) {
        tabButtons[i].className = tabButtons[i].className.replace(" active", "");
      }

      // Show the selected tab content
      document.getElementById(tabName).style.display = "block";

      // Add the active class to the clicked tab button
      evt.currentTarget.className += " active";
    }

    // Open the first tab by default
    document.getElementById('swagger-tab').style.display = "block";
    document.getElementsByClassName("tab-button")[0].className += " active";

    window.onload = function () {
      document.getElementById('file-input').addEventListener('change', function (event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = function (event) {
          const openApiYaml = event.target.result;
          loadSwaggerUIFile(openApiYaml)
          let data = jsyaml.load(openApiYaml)
          initSchema(data["x-enum"])
          initTag(data["x-tags"])
          loadFlow(data["x-flows"])
        };

        reader.readAsText(file);
      });

    }
  </script>
  <script>
    // swagger.js


    function loadSwaggerUIFile(openApiYaml) {
      const ui = SwaggerUIBundle({
        spec: jsyaml.load(openApiYaml),
        dom_id: '#swagger-ui',
        presets: [
          SwaggerUIBundle.presets.apis,
          SwaggerUIStandalonePreset
        ],
        layout: "BaseLayout",
        deepLinking: true
      });
      window.ui = ui;
    };

    function loadSwaggerYaml() {
      var inputText = document.getElementById('swagger_url').value;
      var result = inputText.toLowerCase();
      loadSwaggerUI(result)
    }

    function display(result) {
      document.getElementById('output').innerText = result;
    }

    function loadSwaggerUI(url) {
      const ui = SwaggerUIBundle({
        url: url,
        dom_id: '#swagger-ui',
        presets: [
          SwaggerUIBundle.presets.apis,
          SwaggerUIStandalonePreset
        ],
        layout: "BaseLayout",
        deepLinking: true
      });
      window.ui = ui
    };


  </script>
  <script>

    // enum.js

    var parsedData

    function loadDropdown1() {
      var dropdown1 = document.getElementById('dropdown1');
      dropdown1.innerHTML = '';

      // Populate dropdown1
      Object.keys(parsedData).forEach(function (key) {
        var option = document.createElement('option');
        option.text = key;
        dropdown1.add(option);
      });
    }

    function loadDropdown2() {
      var dropdown1 = document.getElementById('dropdown1');
      var dropdown2 = document.getElementById('dropdown2');
      dropdown2.innerHTML = '';

      // Get the selected value from dropdown1
      var selectedValue1 = dropdown1.value;

      // Populate dropdown2
      let data = flattenObject(parsedData[selectedValue1])
      Object.keys(data).forEach(function (key) {
        var option = document.createElement('option');
        option.text = key;
        dropdown2.add(option);
      });
    }

    function loadDropdown4() {
      var dropdown1 = document.getElementById('dropdown1');
      var dropdown2 = document.getElementById('dropdown2');
      var dropdown4 = document.getElementById('dropdown4');
      dropdown4.innerHTML = '';

      // Get the selected values from dropdown1 and dropdown2
      var selectedValue1 = dropdown1.value;
      var selectedValue2 = dropdown2.value;

      // Populate dropdown4
      let data = getAttribute(parsedData[selectedValue1], selectedValue2.split("."))
      data.forEach(function (item) {
        var option = document.createElement('option');
        option.text = item["code"];
        console.log("iten added", item.code)
        dropdown4.add(option);
      });
      displayTable()
    }

    function getAttribute(data, keyArr) {
      let key = isNaN(keyArr[0]) ? keyArr[0] : parseInt(keyArr[0]);
      if (data[key] && data[key] != undefined) {
        if (keyArr.length == 1) {
          return data[key];
        }
        return this.getAttribute(data[key], keyArr.slice(1, keyArr.length));
      }
      return undefined;
    }

    function flattenObject(obj, prefix = '', result = {}) {
      for (const key in obj) {
        if (obj.hasOwnProperty(key)) {
          const newKey = prefix ? prefix + '.' + key : key;

          if (Array.isArray(obj[key])) {
            result[newKey] = obj[key];
          } else if (typeof obj[key] === 'object' && obj[key] !== null) {
            flattenObject(obj[key], newKey, result);
          } else {
            result[newKey] = obj[key];
          }
        }
      }

      return result;
    }

    function displayTable() {
      var dropdown1 = document.getElementById('dropdown1');
      var dropdown2 = document.getElementById('dropdown2');
      var dropdown4 = document.getElementById('dropdown4');

      // Get the selected values from dropdown1, dropdown2, and dropdown4
      var selectedValue1 = dropdown1.value;
      var selectedValue2 = dropdown2.value;
      var selectedValue3 = dropdown4.value;

      console.log("selectedValue3", selectedValue3)
      // Get the table data
      let data = getAttribute(parsedData[selectedValue1], selectedValue2.split("."))
      var tableData = data.find(obj => {
        if (obj["code"] == selectedValue3)
          return obj
      });

      // Get the table body element
      var tableBody = document.getElementById('result-table');
      if (tableBody && tableBody != {}) tableBody.innerHTML = '';
      insertRow(tableBody, "ENUM", tableData.code)
      insertRow(tableBody, "Description", tableData.description)
      insertRow(tableBody, "Refrences", tableData.reference)
      // insertRow(tableBody, "APIs", tableData.api)

    }

    function insertRow(tableBody, key, value) {
      var row = tableBody.insertRow();
      var cell = row.insertCell();
      cell.innerHTML = key
      var cell = row.insertCell();
      cell.innerHTML = value;
    }

    function fetchData(url) {
      return fetch(url)
        .then(response => response.text())
        .then(yamlData => jsyaml.load(yamlData));
    }

    function populateEnums(url) {
      // Example usage: fetch YAML data from a URL
      fetchData(url).then(data => {
        console.log(data)
        initSchema(data["x-enum"])
        initTag(data["x-tags"])
      })
        .catch(error => {
          console.error('Error fetching or parsing YAML:', error);
        });
    }

    function initSchema(data) {
      parsedData = data
      loadDropdown1()
      loadDropdown2()
      loadDropdown4()
    }
  </script>
  <script>


    // tag.js

    function fetchData(url) {
      return fetch(url)
        .then(response => response.text())
        .then(yamlData => jsyaml.load(yamlData));
    }

    function loadTagSchema() {
      var dropdown1 = document.getElementById('tag-schema-dropdown');
      dropdown1.innerHTML = '';

      // Populate dropdown1
      Object.keys(TagData).forEach(function (key) {
        var option = document.createElement('option');
        option.text = key;
        dropdown1.add(option);
      });
    }

    function loadTagPath() {
      var dropdown1 = document.getElementById('tag-schema-dropdown');
      var dropdown2 = document.getElementById('tag-path-dropdown');
      dropdown2.innerHTML = '';

      // Get the selected value from dropdown1
      var selectedValue1 = dropdown1.value;

      // Populate dropdown2
      let data = flattenObject(TagData[selectedValue1])
      Object.keys(data).forEach(function (key) {
        var option = document.createElement('option');
        option.text = key;
        dropdown2.add(option);
      });
    }

    function loadTagGroup() {
      var dropdown1 = document.getElementById('tag-schema-dropdown');
      var dropdown2 = document.getElementById('tag-path-dropdown');
      var dropdown3 = document.getElementById('tag-group-dropdown');
      dropdown3.innerHTML = '';

      // Get the selected value from dropdown1
      var selectedValue1 = dropdown1.value;
      var selectedValue2 = dropdown2.value;

      // Populate dropdown2
      let data = getAttribute(TagData[selectedValue1], selectedValue2.split("."))
      Object.keys(data).forEach(function (key) {
        var option = document.createElement('option');
        option.text = data[key]["code"];
        dropdown3.add(option);
      });
    }

    function loadTag() {
      var dropdown1 = document.getElementById('tag-schema-dropdown');
      var dropdown2 = document.getElementById('tag-path-dropdown');
      var dropdown3 = document.getElementById('tag-group-dropdown');
      var dropdown4 = document.getElementById('tag-dropdown');
      dropdown4.innerHTML = '';

      // Get the selected values from dropdown1 and dropdown2
      var selectedValue1 = dropdown1.value;
      var selectedValue2 = dropdown2.value;
      var selectedValue3 = dropdown3.value;

      // Populate dropdown4
      let data = getAttribute(TagData[selectedValue1], selectedValue2.split("."))
      let selectedObject3 = data.find(obj => {
        if (obj["code"] === selectedValue3)
          return obj
      });
      let list = selectedObject3.list
      list.forEach(function (obj) {
        var option = document.createElement('option');
        option.text = obj["code"];
        dropdown4.add(option);
      })
      displayTagGroup()
    }

    function getAttribute(data, keyArr) {
      let key = isNaN(keyArr[0]) ? keyArr[0] : parseInt(keyArr[0]);
      if (data[key] && data[key] != undefined) {
        if (keyArr.length == 1) {
          return data[key];
        }
        return this.getAttribute(data[key], keyArr.slice(1, keyArr.length));
      }
      return undefined;
    }

    function flattenObject(obj, prefix = '', result = {}) {
      for (const key in obj) {
        if (obj.hasOwnProperty(key)) {
          const newKey = prefix ? prefix + '.' + key : key;

          if (Array.isArray(obj[key])) {
            result[newKey] = obj[key];
          } else if (typeof obj[key] === 'object' && obj[key] !== null) {
            flattenObject(obj[key], newKey, result);
          } else {
            result[newKey] = obj[key];
          }
        }
      }

      return result;
    }

    function displayTagGroup() {
      var dropdown1 = document.getElementById('tag-schema-dropdown');
      var dropdown2 = document.getElementById('tag-path-dropdown');
      var dropdown3 = document.getElementById('tag-group-dropdown');

      // Get the selected values from dropdown1, dropdown2
      var selectedValue1 = dropdown1.value;
      var selectedValue2 = dropdown2.value;
      var selectedValue3 = dropdown3.value;
      // Get the table data
      let data = flattenObject(TagData[selectedValue1])
      let selectedObject2 = data[selectedValue2]
      let selectedObject3 = selectedObject2.find(obj => {
        if (obj["code"] === selectedValue3)
          return obj
      });
      var tableBody = document.getElementById('tag-group-table');
      if (tableBody && tableBody != {}) tableBody.innerHTML = '';
      insertRow(tableBody, "Code", selectedObject3.code)
      insertRow(tableBody, "Description", selectedObject3.description)
      insertRow(tableBody, "Refrences", selectedObject3.reference)
      displayTag()
    }

    function displayTag() {
      var dropdown1 = document.getElementById('tag-schema-dropdown');
      var dropdown2 = document.getElementById('tag-path-dropdown');
      var dropdown3 = document.getElementById('tag-group-dropdown');
      var dropdown4 = document.getElementById('tag-dropdown');

      // Get the selected values from dropdown1, dropdown2, and dropdown4
      var selectedValue1 = dropdown1.value;
      var selectedValue2 = dropdown2.value;
      var selectedValue3 = dropdown3.value;
      var selectedValue4 = dropdown4.value;
      // Get the table data
      let data = flattenObject(TagData[selectedValue1])
      let selectedObject2 = data[selectedValue2]
      let selectedObject3 = selectedObject2.find(obj => {
        if (obj["code"] === selectedValue3)
          return obj
      });
      let list = selectedObject3["list"]

      var tableData = list.find(obj => {
        if (obj["code"] == selectedValue4)
          return obj
      });
      // Get the table body element
      var tableBody = document.getElementById('tag-table');
      if (tableBody && tableBody != {}) tableBody.innerHTML = '';
      insertRow(tableBody, "Code", tableData.code)
      insertRow(tableBody, "Description", tableData.description)
      insertRow(tableBody, "Refrences", tableData.reference)

    }

    function insertRow(tableBody, key, value) {
      var row = tableBody.insertRow();
      var cell = row.insertCell();
      cell.innerHTML = key
      var cell = row.insertCell();
      cell.innerHTML = value;
    }

    function fetchTag() {
      var inputText = document.getElementById('tag_url').value;
      var result = inputText.toLowerCase();
      populateTags(result);
    }

    function populateTags(url) {
      // Example usage: fetch YAML data from a URL
      fetchData(url).then(data => {
        console.log(data)
        initTag(data)
      })
        .catch(error => {
          console.error('Error fetching or parsing YAML:', error);
        });
    }

    function initTag(data) {
      TagData = data
      loadTagSchema()
      loadTagPath()
      loadTagGroup()
      loadTag()
    }

  </script>
  <script>
    // flow.js

    function loadSteps(steps) {
      const stepsList = document.getElementById('steps-list');
      const stepSummary = document.getElementById('step-summary');
      const stepDescription = document.getElementById('step-description');
      const yamlContent = document.getElementById('yaml-content');
      // Render the steps list
      steps.forEach((step, index) => {
        const li = document.createElement('li');
        li.textContent = step["summary"] + " API:" + step["api"];
        li.classList.add('step');
        li.dataset.index = index;
        stepsList.appendChild(li);
      });

      // Add click event listener to each step
      const flowElements = document.getElementsByClassName('step');
      Array.from(flowElements).forEach(step => {
        step.addEventListener('click', handleFlowClick);
      });

      // Handle step click event
      function handleFlowClick(event) {
        const clickedStep = event.target;
        const stepIndex = clickedStep.dataset.index;

        // Remove 'active' class from all steps
        Array.from(flowElements).forEach(flow => {
          flow.classList.remove('active');
        });

        // Add 'active' class to clicked step
        clickedStep.classList.add('active');

        // Get YAML content for the selected step index
        const selectedStep = steps[stepIndex];
        stepSummary.textContent = selectedStep["summary"]
        stepDescription.textContent = selectedStep["description"]
        yamlContent.textContent = JSON.stringify(selectedStep["example"]["value"], null, 2);
      }

    };


    function loadFlow(flows) {
      const flowsList = document.getElementById('flows-list');
      const flowSummary = document.getElementById('flow-summary');
      const flowDescription = document.getElementById('flow-description');
      // Render the steps list
      flows.forEach((flow, index) => {
        const li = document.createElement('li');
        li.textContent = flow["summary"];
        li.classList.add('flow');
        li.dataset.index = index;
        flowsList.appendChild(li);
      });

      // Add click event listener to each step
      const flowElements = document.getElementsByClassName('flow');
      Array.from(flowElements).forEach(step => {
        step.addEventListener('click', handleFlowClick);
      });

      // Handle step click event
      function handleFlowClick(event) {
        const clickedStep = event.target;
        const flowIndex = clickedStep.dataset.index;

        // Remove 'active' class from all steps
        Array.from(flowElements).forEach(flow => {
          flow.classList.remove('active');
        });

        // Add 'active' class to clicked step
        clickedStep.classList.add('active');

        // Get YAML content for the selected step index
        const selectedFlow = flows[flowIndex];
        flowSummary.textContent = selectedFlow["summary"]
        flowDescription.textContent = selectedFlow["description"]
        loadSteps(selectedFlow["steps"])
      }

    };
  </script>

  <!--

-->

</body>

</html>